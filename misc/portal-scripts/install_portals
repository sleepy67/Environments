##Script should be run as playadm user
##Check for parameter
##check if jdk installed

Portal_version=0.7.0
Start_Pages_Version=0.7.0
CCP_Checker_Version=0.7.0
CI_Server=10.80.67.57:8081
MicroServicesURL=10.80.64.54:8189
PortalURL=10.80.64.51
StartPagesURL=10.80.64.57
CCPCheckerURL=10.80.64.58

echo ""

if curl --output /dev/null --silent --head --fail "$CI_Server"
then
    echo "True :- Server is accessible at $CI_Server"
else
    echo "False :- Server is accessible at $CI_Server"
fi

wget http://$CI_Server/content/repositories/releases/net/atos/tfc/tfc-portal/$Portal_version/tfc-portal-$Portal_version.zip -P /appl/builddir/
wget http://$CI_Server/content/repositories/releases/net/atos/tfc/tfc-start-pages/$Start_Pages_Version/tfc-start-pages-$Start_Pages_Version.zip -P /appl/builddir/
wget http://$CI_Server/content/repositories/releases/net/atos/tfc/tfc-ccp-checker/$CCP_Checker_Version/tfc-ccp-checker-$CCP_Checker_Version.zip -P /appl/builddir/

chmod 660 /appl/builddir/tfc-portal-$Portal_version.zip
chmod 660 /appl/builddir/tfc-start-pages-$Start_Pages_Version.zip
chmod 660 /appl/builddir/tfc-ccp-checker-$CCP_Checker_Version.zip

unzip /appl/builddir/tfc-portal-$Portal_version.zip -d /appl/tfc/play
ln -sfn /appl/tfc/play/tfc-portal-$Portal_version /appl/tfc/play/latest-portal

unzip /appl/builddir/tfc-start-pages-$Start_Pages_Version.zip -d /appl/tfc/play
ln -sfn /appl/tfc/play/tfc-start-pages-$Start_Pages_Version /appl/tfc/play/latest-start-pages

unzip /appl/builddir/tfc-ccp-checker-$CCP_Checker_Version.zip -d /appl/tfc/play
ln -sfn /appl/tfc/play/tfc-ccp-checker-$CCP_Checker_Version /appl/tfc/play/latest-ccp-checker

#Portal
sed -i '/address/s/127.0.0.1/0.0.0.0'/ /appl/tfc/play/latest-portal/conf/application.conf
sed -i "/MicroServicesURL/s/127.0.0.1:5900/$MicroServicesURL"/ /appl/tfc/play/latest-portal/conf/application.conf
sed -i '/StartPageUrl/s/http/https'/ /appl/tfc/play/latest-portal/conf/application.conf
sed -i "/StartPageUrl/s/127.0.0.1:9003/$StartPagesURL"/ /appl/tfc/play/latest-portal/conf/application.conf
sed -i '/RSAOn/s/false/true'/ /appl/tfc/play/latest-portal/conf/application.conf
sed -i "/PortalURLForIDA/s/localhost:9000/$PortalURL"/ /appl/tfc/play/latest-portal/conf/application.conf

#Start Pages
sed -i '/address/s/127.0.0.1/0.0.0.0'/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i "/MicroServicesURL/s/127.0.0.1:5900/$MicroServicesURL"/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i '/PortalURL/s/http/https'/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i "/PortalURL /s/127.0.0.1:9000/$PortalURL"/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i "/PortalURLForIDA/s/localhost:9000/$PortalURL"/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i '/StartPageUrl/s/http/https'/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i "/StartPageUrl/s/127.0.0.1:9003/$StartPagesURL"/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i '/CheckerURL/s/http/https'/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i "/CheckerURL/s/127.0.0.1:9002/$CCPCheckerURL"/ /appl/tfc/play/latest-start-pages/conf/application.conf
sed -i '/RSAOn/s/false/true'/ /appl/tfc/play/latest-start-pages/conf/application.conf

#CCP-Checker
sed -i '/address/s/127.0.0.1/0.0.0.0'/ /appl/tfc/play/latest-ccp-checker/conf/application.conf
sed -i '/port/s/9002/9004'/ /appl/tfc/play/latest-ccp-checker/conf/application.conf
sed -i '/StartPageUrl/s/http/https'/ /appl/tfc/play/latest-ccp-checker/conf/application.conf
sed -i "/StartPageUrl/s/127.0.0.1:9003/$StartPagesURL"/ /appl/tfc/play/latest-ccp-checker/conf/application.conf
sed -i "/MicroServicesURL/s/127.0.0.1:5900/$MicroServicesURL"/ /appl/tfc/play/latest-ccp-checker/conf/application.conf
sed -i '/RSAOn/s/false/true'/ /appl/tfc/play/latest-ccp-checker/conf/application.conf
sed -i "/PortalURLForIDA/s/localhost:9000/$PortalURL"/ /appl/tfc/play/latest-ccp-checker/conf/application.conf

echo ""
echo "TFC Portal Installed :"
echo "Exit from the fuseadm user then start the Portal service using;"
echo ""
echo "sudo service tfc-portal stop"
echo ""
echo "sudo service tfc-start-pages stop"
echo "sudo service tfc-ccp-checker stop"
echo "sudo service tfc-portal start"
echo "sudo service tfc-start-pages start"
echo "sudo service tfc-ccp-checker start"
echo ""
